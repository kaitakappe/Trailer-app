# ヒッチメンバー強度計算モジュール

トレーラーアプリにヒッチメンバーの強度計算機能を追加しました。

## 機能概要

ヒッチメンバー（トレーラーの連結部）の強度を計算します。垂直荷重と水平牽引力の合成曲げモーメントから、破断安全率と降伏安全率を評価します。

## 計算対象

- **円形ヒッチメンバー**：直径で指定
- **角形ヒッチメンバー**：辺長と肉厚で指定

## 入力パラメータ

| 項目 | 単位 | 説明 |
|------|------|------|
| 垂直荷重 P | kg | ヒッチに作用する垂直荷重 |
| 水平牽引力 H | kg | ブレーキ時などの水平方向牽引力 |
| ヒッチ有効長さ | mm | 球面から取り付け面までの距離 |
| 直径 or 辺長 | mm | 部材の外形寸法 |
| 肉厚 | mm | 角形の場合の肉厚 |
| 引張強さ | kg/cm² | 材料の引張強さ θb |
| 降伏点 | kg/cm² | 材料の降伏点 θy |
| 荷重倍率 | - | 安全率計算時の倍率（デフォルト: 2.5） |

## 計算式

### 曲げモーメント
- 垂直曲げモーメント：M_V = P × L
- 水平曲げモーメント：M_H = H × L
- 合成曲げモーメント：M = √(M_V² + M_H²)

### 断面係数
**円形の場合：**
```
Z = π × d³ / 32  [cm³]
```

**角形の場合（中抜き正方形）：**
```
Z = (a⁴ - b⁴) / (6×a)  [cm³]
a = 外辺長, b = 内辺長 = a - 2×t (t:肉厚)
```

### 応力と安全率
- 曲げ応力：σ = M / Z
- 破断安全率：SF_break = θb / (factor × σ)
- 降伏安全率：SF_yield = θy / (factor × σ)

## 判定基準

- **破断安全率 > 1.6** ✓ OK
- **降伏安全率 > 1.3** ✓ OK

## 使用例

```python
from lib import compute_hitch_strength, format_hitch_strength_result

# 円形ヒッチメンバー
result = compute_hitch_strength(
    P=1500,              # 垂直荷重 1500kg
    H=300,               # 水平牽引力 300kg
    L_mm=200,            # 有効長さ 200mm
    d_mm=60,             # 直径 60mm
    tensile_strength=410,
    yield_strength=240,
    material_type='round'
)
print(format_hitch_strength_result(result))

# 角形ヒッチメンバー
result = compute_hitch_strength(
    P=1500,
    H=300,
    L_mm=200,
    d_mm=80,             # 辺長 80mm
    thickness_mm=5,      # 肉厚 5mm
    tensile_strength=410,
    yield_strength=240,
    material_type='square'
)
print(format_hitch_strength_result(result))
```

## 入力項目の位置イメージ（簡易図）

```
          ┌───────── 牽引車側フレーム ─────────┐
          │                                      │
          │      ← 水平牽引力 H                │
          │                 ↘                   │
          │                  ● ヒッチボール     │
          │                  │                  │
          │                  │ 垂直荷重 P ↓     │
          │                  │                  │
取り付け面└─────────────┼───────────────┘
                           ↑
                           │ L（有効長さ）
                           │
                 ┌─────────┴─────────┐
                 │   ヒッチメンバー部材   │
                 └─────────┬─────────┘
                           │
             外径/辺長 d → └───○───┘  ← 肉厚 t（角形のみ）
```

- P: ヒッチボール位置に作用する垂直荷重
- H: 牽引・制動時に作用する水平荷重
- L: ボール中心から取り付け面までの有効長さ
- d: 円形なら直径、角形なら外辺長
- t: 角形の場合の肉厚

## ファイル構成

- `lib/hitch_strength.py`：計算エンジン
  - `compute_hitch_strength()`：計算実行関数
  - `format_hitch_strength_result()`：結果整形関数
- `main.py`：UIパネル `HitchStrengthPanel`
  - 入力フォーム
  - 計算ボタン
  - PDF出力機能

## UI 操作方法

1. **パネル選択**：タブから「ヒッチメンバー強度」を選択
2. **入力**：各項目に値を入力
3. **形状選択**：「円形」または「角形」を選択
4. **計算**：「計算」ボタンをクリック
5. **結果確認**：計算結果が表示される
6. **PDF出力**：「PDF出力」ボタンで書類化

## 安全率について

- 破断安全率：材料が破断するまでの余裕度
- 降伏安全率：塑性変形が生じるまでの余裕度

いずれも高いほど安全です。

## 参考資料

- 日本の保安基準（トレーラー仕様）
- 材料力学の曲げモーメント計算
- 安全係数 2.5 倍（設計基準）
